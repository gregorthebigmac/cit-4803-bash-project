#!/bin/bash

# This script will serve as the login screen

# High level description:
# 1. Prompt user for username.
#	a. I think we should take the Linux approach to this and ask for username,
#		ask for password, but don't validate the username and password
#		separately, validate them together. This allows for greater security.
# 2. Prompt user for password.
#	a. Check username. Is it valid?
#		1. YES	-> check password. Is it valid?
#			a. YES	-> run main.sh
#			b. NO	-> fail with message and run login.sh
#		2. NO	-> fail with message and run login.sh

tput reset #clears terminal

echo "                 Welcome to Bashuntu"
echo "              The Shell Within a Shell!"
echo "                                            'yo, dawg...'"
echo " "

cat "$root_dir/system_files/config/yo_dawg.art"

echo "Bashuntu 0.4.2 LTS $(hostname) tty1"
echo -n "$(hostname) login: "
read username
echo -n "password for $username: "
read -s password
echo " "
echo "Checking..."
valid=0
user_loop_counter=0
pass_loop_counter=0
while read users; do
	echo "username = $username"
	echo "password = $password"
	echo "users = $users"
	if [[ "$users" == *"$username"* ]]; then
		echo "Found a username substring match!"
		if [[ "$users" == *"$password"* ]]; then
			echo "Found a password substring match!"
			for x in $users; do
				if ((valid == 0)); then
					user_loop_counter=$((user_loop_counter + 1))
					pass_loop_counter=$((pass_loop_counter + 1))
				fi
				echo "username = $username"
				echo "x = $x"
				if [[ "$username" == "$x" ]]; then
					echo "Found an exact username match!"
					valid=$((valid + 1))
				else echo "Not a username match!"
				fi
				if ((valid == 1)); then
					if [[ "$password" == "$x" ]]; then
						echo "Found an exact password match!"
						valid=$((valid + 1))
					else echo "Not a password match!"
					fi
				fi
			done
		fi
	else echo "Still looking..."
	fi
done < <(cat $root_dir/system_files/config/users)
echo "Checking...[done]"
if (( valid == 2 )); then
	echo "Username and password match found!"
else echo "Username and password not found!"
fi
